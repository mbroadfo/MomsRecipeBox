openapi: 3.0.0
info:
  title: MomsRecipeBox API
  description: API documentation for the MomsRecipeBox backend
  version: 1.0.0
servers:
  - url: http://localhost:3000
  - url: https://sar6jpcqz1.execute-api.us-west-2.amazonaws.com/dev

tags:
  - name: recipes
    description: Recipe management operations
  - name: comments
    description: Recipe comment operations
  - name: likes
    description: Recipe like operations
  - name: images
    description: Recipe image operations

paths:
  /recipes:
    post:
      tags:
        - recipes
      summary: Create a new recipe
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecipeInput'
      responses:
        '201':
          description: Recipe created
    get:
      tags:
        - recipes
      summary: Get a list of recipes
      parameters:
      - in: query
        name: owner_id
        schema:
          type: string
      - in: query
        name: visibility
        schema:
          type: string
      - in: query
        name: tags
        schema:
          type: string
      - in: query
        name: expand
        schema:
          type: string
      - in: query
        name: limit
        schema:
          type: integer
      - in: query
        name: offset
        schema:
          type: integer
      responses:
        '200':
          description: List of recipes

  /recipes/{id}:
    get:
      tags:
        - recipes
      summary: Get a specific recipe by ID
      parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
      - in: query
        name: expand
        schema:
          type: string
      responses:
        '200':
          description: A single recipe
    put:
      tags:
        - recipes
      summary: Update a specific recipe by ID
      parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RecipeInput'
      responses:
        '200':
          description: Recipe updated
    delete:
      tags:
        - recipes
      summary: Delete a recipe by ID
      parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Recipe deleted

  /recipes/{id}/comments:
    post:
      tags:
        - comments
      summary: Post a comment on a recipe
      parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentInput'
      responses:
        '200':
          description: Comment added

  /comments/{comment_id}:
    put:
      tags:
        - comments
      summary: Update a comment
      parameters:
      - in: path
        name: comment_id
        required: true
        schema:
          type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentInput'
      responses:
        '200':
          description: Comment updated
    delete:
      tags:
        - comments
      summary: Delete a comment
      parameters:
      - in: path
        name: comment_id
        required: true
        schema:
          type: string
      responses:
        '200':
          description: Comment deleted

  /recipes/{id}/like:
    post:
      tags:
        - likes
      summary: Toggle like for a recipe
      parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: string
      responses:
        '200':
          description: Like toggled
  /recipes/{id}/image:
    put:
      tags:
        - images
      summary: Upload or update an image for a recipe
      description: Upload or update an image using base64 encoding. Supports PNG and JPEG formats. Use this method for both initial upload and updates.
      parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
        description: Recipe ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                imageBase64:
                  type: string
                  description: Base64-encoded image data
                contentType:
                  type: string
                  description: Content type of the image (image/png or image/jpeg)
                  enum: [image/png, image/jpeg]
            example:
              imageBase64: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8BQDwAEhQGAhKmMIQAAAABJRU5ErkJggg=="
              contentType: "image/png"
      responses:
        '200':
          description: Image updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Image updated successfully!
                  key:
                    type: string
                    example: 60f1e5b0e6b3a123456789ab.png
                  contentType:
                    type: string
                    example: image/png
        '400':
          description: Bad request - invalid input
        '404':
          description: Recipe not found
        '500':
          description: Internal server error
    delete:
      tags:
        - images
      summary: Delete an image for a recipe
      description: Delete a recipe's image. This will revert the recipe to use the default image.
      parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
        description: Recipe ID
      responses:
        '200':
          description: Image deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Image deleted successfully!
        '404':
          description: Recipe or image not found
        '500':
          description: Internal server error
    get:
      tags:
        - images
      summary: Get an image for a recipe
      description: Retrieve an image for a recipe. If no image exists for the recipe, returns the default image.
      parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
        description: Recipe ID
      - in: header
        name: Accept
        schema:
          type: string
          enum: [image/png, image/jpeg]
        description: Preferred image format (optional)
      responses:
        '200':
          description: Image fetched successfully
          content:
            image/png:
              schema:
                type: string
                format: binary
            image/jpeg:
              schema:
                type: string
                format: binary
            image/gif:
              schema:
                type: string
                format: binary
        '404':
          description: Recipe not found
        '500':
          description: Internal server error

components:
  schemas:
    RecipeInput:
      type: object
      required:
      - owner_id
      - visibility
      - title
      properties:
        owner_id:
          type: string
        visibility:
          type: string
        status:
          type: string
        title:
          type: string
        subtitle:
          type: string
        description:
          type: string
        image_url:
          type: string
        tags:
          type: array
          items:
            type: string
        sections:
          type: array
          items:
            type: object
            properties:
              section_type:
                type: string
              content:
                type: string
              position:
                type: integer
        ingredients:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
              quantity:
                type: string
              position:
                type: integer

    CommentInput:
      type: object
      properties:
        user_id:
          type: string
        content:
          type: string
